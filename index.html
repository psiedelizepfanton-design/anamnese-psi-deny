<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Anamnese â€“ Psi Dra. Deny</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Inter, Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
}

header {
  background: #1f3c88;
  color: #fff;
  padding: 20px;
  text-align: center;
}

main {
  padding: 20px;
  display: flex;
  gap: 20px;
}

.panel {
  background: #fff;
  border-radius: 8px;
  padding: 15px;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
}

#pacientes {
  width: 30%;
}

#conteudo {
  width: 70%;
}

input, select, textarea, button {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  margin-bottom: 12px;
}

textarea {
  min-height: 80px;
}

button {
  background: #1f3c88;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button.sec {
  background: #999;
}

.lista {
  max-height: 400px;
  overflow-y: auto;
}

.item {
  padding: 8px;
  border-bottom: 1px solid #ddd;
  cursor: pointer;
}

.item:hover {
  background: #eef2ff;
}

h3 {
  margin-top: 0;
  color: #1f3c88;
}

small {
  color: #666;
}
</style>
</head>

<body>

<header>
  <h1>Sistema de Anamnese ClÃ­nica</h1>
  <small>Uso exclusivo â€“ Psi Dra. Deny</small>
</header>

<main>

<div id="pacientes" class="panel">
  <h3>Pacientes</h3>
  <input id="novoNome" placeholder="Nome do paciente">
  <button onclick="criarPaciente()">Adicionar</button>
  <div class="lista" id="listaPacientes"></div>
</div>

<div id="conteudo" class="panel">
  <h3 id="tituloPaciente">Selecione um paciente</h3>

  <div id="blocos" style="display:none">

    <h4>ðŸ“Œ Anamnese Inicial</h4>

    <textarea id="queixa" placeholder="Queixa principal"></textarea>
    <textarea id="objetivo" placeholder="Objetivo terapÃªutico"></textarea>
    <textarea id="historia" placeholder="HistÃ³ria do problema"></textarea>
    <textarea id="contexto" placeholder="Contexto psicossocial"></textarea>
    <textarea id="avaliacao" placeholder="AvaliaÃ§Ã£o clÃ­nica inicial"></textarea>

    <button onclick="salvarAnamnese()">Salvar Anamnese</button>

    <hr>

    <h4>ðŸ—“ SessÃ£o ClÃ­nica</h4>
    <input type="date" id="dataSessao">
    <textarea id="evolucao" placeholder="EvoluÃ§Ã£o da sessÃ£o"></textarea>
    <textarea id="intervencao" placeholder="IntervenÃ§Ãµes realizadas"></textarea>
    <textarea id="plano" placeholder="Plano para prÃ³xima sessÃ£o"></textarea>

    <button onclick="salvarSessao()">Salvar SessÃ£o</button>

    <hr>

    <h4>ðŸ“š HistÃ³rico</h4>
    <div id="historico"></div>

    <hr>

    <button class="sec" onclick="exportar()">Exportar Backup</button>
    <button class="sec" onclick="importar()">Importar Backup</button>

  </div>
</div>

</main>

<script>
let pacientes = JSON.parse(localStorage.getItem("psi_deny")) || {};
let atual = null;

function salvar() {
  localStorage.setItem("psi_deny", JSON.stringify(pacientes));
}

function criarPaciente() {
  const nome = novoNome.value.trim();
  if (!nome) return alert("Informe o nome.");
  pacientes[nome] = { anamnese:{}, sessoes:[] };
  salvar();
  renderPacientes();
  novoNome.value="";
}

function renderPacientes() {
  listaPacientes.innerHTML="";
  Object.keys(pacientes).forEach(n=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerText=n;
    d.onclick=()=>abrirPaciente(n);
    listaPacientes.appendChild(d);
  });
}

function abrirPaciente(nome) {
  atual = nome;
  tituloPaciente.innerText = nome;
  blocos.style.display="block";
  const a = pacientes[nome].anamnese;
  queixa.value=a.queixa||"";
  objetivo.value=a.objetivo||"";
  historia.value=a.historia||"";
  contexto.value=a.contexto||"";
  avaliacao.value=a.avaliacao||"";
  renderHistorico();
}

function salvarAnamnese() {
  pacientes[atual].anamnese = {
    queixa:queixa.value,
    objetivo:objetivo.value,
    historia:historia.value,
    contexto:contexto.value,
    avaliacao:avaliacao.value
  };
  salvar();
  alert("Anamnese salva.");
}

function salvarSessao() {
  if (!dataSessao.value) return alert("Informe a data.");
  pacientes[atual].sessoes.push({
    data:dataSessao.value,
    evolucao:evolucao.value,
    intervencao:intervencao.value,
    plano:plano.value
  });
  salvar();
  evolucao.value=intervencao.value=plano.value="";
  renderHistorico();
}

function renderHistorico() {
  historico.innerHTML="";
  pacientes[atual].sessoes.forEach(s=>{
    historico.innerHTML+=`
      <div class="item">
        <b>${s.data}</b><br>
        EvoluÃ§Ã£o: ${s.evolucao}<br>
        IntervenÃ§Ãµes: ${s.intervencao}<br>
        Plano: ${s.plano}
      </div>`;
  });
}

function exportar() {
  const blob = new Blob([JSON.stringify(pacientes)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="backup-psi-deny.json";
  a.click();
}

function importar() {
  const i=document.createElement("input");
  i.type="file";
  i.accept="application/json";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{pacientes=JSON.parse(r.result); salvar(); renderPacientes();};
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

renderPacientes();
</script>

</body>
</html>
